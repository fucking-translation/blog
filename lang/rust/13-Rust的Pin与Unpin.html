<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust çš„ Pin ä¸ Unpin - Blog Translation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../../theme/ferris.css">
        
        <link rel="stylesheet" href="../../theme/2018-edition.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../lang/rust/01-ç”¨Rustå­¦ä¹ è§£æå™¨ç»„åˆå™¨.html"><strong aria-hidden="true">1.</strong> ç”¨ Rust å­¦ä¹ è§£æå™¨ç»„åˆå™¨</a></li><li class="chapter-item expanded "><a href="../../lang/rust/02-ç”¨Rustç¼–å†™LLVMçš„ç©å…·å‰ç«¯.html"><strong aria-hidden="true">2.</strong> ç”¨ Rust ç¼–å†™ LLVM çš„ç©å…·å‰ç«¯</a></li><li class="chapter-item expanded "><a href="../../lang/rust/03-ä½¿ç”¨nomè§£æurl.html"><strong aria-hidden="true">3.</strong> ä½¿ç”¨ nom è§£æ url</a></li><li class="chapter-item expanded "><a href="../../lang/rust/04-Rustä¸­å¼‚æ­¥ç¼–ç¨‹å®ç”¨ä»‹ç».html"><strong aria-hidden="true">4.</strong> Rust ä¸­å¼‚æ­¥ç¼–ç¨‹å®ç”¨ä»‹ç»</a></li><li class="chapter-item expanded "><a href="../../lang/rust/05-tokioå†…å¹•-è‡ªåº•å‘ä¸Šç†è§£Rustçš„å¼‚æ­¥IOæ¡†æ¶.html"><strong aria-hidden="true">5.</strong> tokio å†…å¹•-è‡ªåº•å‘ä¸Šç†è§£ Rust çš„å¼‚æ­¥ IO æ¡†æ¶</a></li><li class="chapter-item expanded "><a href="../../lang/rust/06-Rustä¸­çš„Arenas.html"><strong aria-hidden="true">6.</strong> Rust ä¸­çš„ Arenas</a></li><li class="chapter-item expanded "><a href="../../lang/rust/07-Rustå¼‚æ­¥IO:ä»mioåˆ°coroutine.html"><strong aria-hidden="true">7.</strong> Rust å¼‚æ­¥ IO: ä» mio åˆ° coroutine</a></li><li class="chapter-item expanded "><a href="../../lang/rust/08-å›¾è§£Rustæ‰€æœ‰æƒä¸ç”Ÿå‘½å‘¨æœŸ.html"><strong aria-hidden="true">8.</strong> å›¾è§£ Rust æ‰€æœ‰æƒä¸ç”Ÿå‘½å‘¨æœŸ</a></li><li class="chapter-item expanded "><a href="../../lang/rust/09-Rustå¼‚æ­¥æ‰§è¡Œå™¨.html"><strong aria-hidden="true">9.</strong> Rust å¼‚æ­¥æ‰§è¡Œå™¨</a></li><li class="chapter-item expanded "><a href="../../lang/rust/11-Rustä¸­çš„å®:å¸¦æœ‰ç¤ºä¾‹çš„æ•™ç¨‹.html"><strong aria-hidden="true">10.</strong> Rustä¸­çš„å®: å¸¦æœ‰ç¤ºä¾‹çš„æ•™ç¨‹</a></li><li class="chapter-item expanded "><a href="../../lang/rust/12-libp2pæ•™ç¨‹:ä½¿ç”¨Rustæ„å»ºp2påº”ç”¨.html"><strong aria-hidden="true">11.</strong> libp2p æ•™ç¨‹: ä½¿ç”¨ Rust æ„å»º p2p åº”ç”¨</a></li><li class="chapter-item expanded "><a href="../../lang/rust/13-Rustçš„Pinä¸Unpin.html" class="active"><strong aria-hidden="true">12.</strong> Rust çš„ Pin ä¸ Unpin</a></li><li class="chapter-item expanded "><a href="../../lang/rust/14-ä½¿ç”¨GDBè°ƒè¯•Ruståº”ç”¨.html"><strong aria-hidden="true">13.</strong> ä½¿ç”¨ GDB è°ƒè¯• Rust ä¸­çš„åº”ç”¨</a></li><li class="chapter-item expanded "><a href="../../lang/rust/15-è§£é‡ŠRustä¸­çš„åŸå­æ€§.html"><strong aria-hidden="true">14.</strong> è§£é‡Š Rust ä¸­çš„åŸå­æ€§</a></li><li class="chapter-item expanded "><a href="../../lang/rust/16-Rustå’ŒTUI:åœ¨Rustä¸­æ„å»ºå‘½ä»¤è¡Œç•Œé¢.html"><strong aria-hidden="true">15.</strong> Rust å’Œ TUIï¼šåœ¨ Rust ä¸­æ„å»ºå‘½ä»¤è¡Œç•Œé¢</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Blog Translation</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/fucking-translation/blog" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="è½¬rust-çš„-pin-å’Œ-unpin"><a class="header" href="#è½¬rust-çš„-pin-å’Œ-unpin">ã€Œè½¬ã€Rust çš„ Pin å’Œ Unpin</a></h1>
<blockquote>
<p>è½¬è½½ï¼š<a href="https://folyd.com/blog/rust-pin-unpin/">Rust çš„ Pin å’Œ Unpin</a></p>
</blockquote>
</br>
<p>2019å¹´2æœˆ28å·ï¼ŒRust 1.33ç‰ˆå‘å¸ƒï¼Œå¢åŠ äº†æ–°çš„pinning APIï¼Œä¸»è¦åŒ…æ‹¬è¿™å‡ ä¸ªï¼š</p>
<ul>
<li><code>std::pin::Pin</code></li>
<li><code>std::marker::Unpin</code></li>
<li><code>std::marker::PhantomPinned</code></li>
<li><code>impl !Unpin for T</code></li>
</ul>
<p>åˆšå¼€å§‹æ¥è§¦è¿™äº›æ¦‚å¿µçš„æ—¶å€™æ„Ÿè§‰ç‰¹åˆ«ç»•ï¼Œæœ‰ç‚¹éš¾ç†è§£é€å½»ã€‚ç½‘ä¸Šä¹Ÿæœ‰ä¸å°‘è®²<code>Pin</code>å’Œ<code>Unpin</code>çš„æ–‡ç« ï¼Œä½†æ€»æ„Ÿè§‰è®²å¾—ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šã€‚ç›´æ¥å»çœ‹ <a href="https://doc.rust-lang.org/std/pin/index.html">std::pin æ¨¡å—</a>çš„æ–‡æ¡£ç†è§£èµ·æ¥ä¹ŸæŒºæœ‰éš¾åº¦çš„ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« æˆ‘å°†å°è¯•ç”±æµ…å…¥æ·±çš„æ¢³ç†ä¸€ä¸‹<code>Pin</code>å’Œ<code>Unpin</code>ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶ç†è§£è¿™äº›æ¦‚å¿µã€‚</p>
<h2 id="æ¦‚å¿µ"><a class="header" href="#æ¦‚å¿µ">æ¦‚å¿µ</a></h2>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹<code>Pin</code>å®˜æ–¹æ–‡æ¡£ä¸Šçš„å®šä¹‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>///
/// This is a wrapper around a kind of pointer which makes that pointer &quot;pin&quot; its
/// value in place, preventing the value referenced by that pointer from being moved
/// unless it implements [`Unpin`].
#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
#[lang = &quot;pin&quot;]
#[fundamental]
#[repr(transparent)]
#[derive(Copy, Clone)]
pub struct Pin&lt;P&gt; {
    pointer: P,
}

#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl&lt;P: Deref&gt; Deref for Pin&lt;P&gt; {
    type Target = P::Target;
    fn deref(&amp;self) -&gt; &amp;P::Target {
        Pin::get_ref(Pin::as_ref(self))
    }
}

#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl&lt;P: DerefMut&lt;Target: Unpin&gt;&gt; DerefMut for Pin&lt;P&gt; {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut P::Target {
        Pin::get_mut(Pin::as_mut(self))
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>æˆ‘å…ˆæ¥ä»å®è§‚å±‚é¢è§£è¯»ä¸€ä¸‹ã€‚<code>Pin</code>æ˜¯ä¸€ä¸ªè¿™æ ·çš„æ™ºèƒ½æŒ‡é’ˆï¼Œä»–å†…éƒ¨åŒ…è£¹äº†å¦å¤–ä¸€ä¸ªæŒ‡é’ˆ Pï¼Œå¹¶ä¸”åªè¦ P æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼ˆæˆ‘ä»¬ç§°ä¸º T ï¼‰æ²¡æœ‰å®ç°<code>Unpin</code>ï¼Œåˆ™å¯ä»¥ä¿è¯ T æ°¸è¿œä¸ä¼šè¢«ç§»åŠ¨ (move)ã€‚<code>Pin</code>è¿™ä¸ªå•è¯ä¹Ÿå¾ˆå½¢è±¡çš„è¡¨ç¤º<code>Pin</code>å°±åƒé’‰å­ä¸€æ ·å¯ä»¥æŠŠTé’‰ä½ã€‚æ‰€ä»¥<code>Pin</code>ä¸€èˆ¬æ¥è¯´ç”¨<code>Pin&lt;P&lt;T&gt;&gt;</code>è¿™ç§æ–¹å¼è¡¨ç¤º (P æ˜¯ Pointer çš„ç¼©å†™ï¼ŒT æ˜¯ Type çš„ç¼©å†™)ã€‚è¿™ä¸ªå®šä¹‰åˆçœ‹æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬æ¥åˆ’å‡ ä¸ªé‡ç‚¹ï¼š</p>
<ul>
<li><code>Pin</code>è‡ªèº«æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä»– impl äº†<code>Deref</code>å’Œ<code>DerefMut</code>ã€‚</li>
<li><code>Pin</code>åŒ…è£¹çš„å†…å®¹åªèƒ½æ˜¯æŒ‡é’ˆï¼Œä¸èƒ½æ˜¯å…¶ä»–æ™®é€šç±»å‹ã€‚æ¯”å¦‚<code>Pin&lt;u32&gt;</code>å°±æ²¡æœ‰æ„ä¹‰ã€‚</li>
<li><code>Pin</code>å…·æœ‰â€œé’‰ä½â€ T ä¸èƒ½ç§»åŠ¨çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯å¦ç”Ÿæ•ˆå–å†³äº T æ˜¯å¦ impl <code>Unpin</code>ã€‚ç®€å•çš„è¯´ï¼Œå¦‚æœ T å®ç°äº†<code>Unpin</code>ï¼Œ<code>Pin</code>çš„â€œé’‰ä½â€åŠŸèƒ½å®Œå…¨å¤±æ•ˆäº†ï¼Œè¿™æ—¶å€™çš„<code>Pin&lt;P&lt;T&gt;&gt;</code>å°±ç­‰ä»·äº<code>P&lt;T&gt;</code>ã€‚</li>
<li><code>Unpin</code>æ˜¯ä¸€ä¸ª<code>auto trait</code>ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šç»™æ‰€æœ‰ç±»å‹å®ç°<code>Unpin</code>ã€‚å”¯ç‹¬æœ‰å‡ ä¸ªä¾‹å¤–ï¼Œä»–ä»¬å®ç°çš„æ˜¯<code>!Unpin</code>ã€‚è¿™å‡ ä¸ªä¾‹å¤–æ˜¯<code>PhantomPinned</code>ï¼Œç¼–è¯‘å™¨ä¸º<code>async/await desugar</code>ä¹‹åç”Ÿæˆçš„impl <code>Future</code>çš„ç»“æ„ä½“ã€‚</li>
<li>æ‰€ä»¥<code>Pin&lt;P&lt;T&gt;&gt;</code>é»˜è®¤æƒ…å†µä¸‹çš„â€œé’‰ä½â€åŠŸèƒ½æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼Œåªé’ˆå¯¹ä¸Šé¢è¯´çš„è¿™å‡ ä¸ªimpl <code>!Unpin</code>çš„æƒ…å†µç”Ÿæ•ˆã€‚</li>
</ul>
<p>çœ‹äº†è¿™å‡ æ¡å¯èƒ½è¿˜æœ‰ç‚¹æ‡µï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¼€å§‹é€æ¡å‰–æã€‚é¦–å…ˆè¦ææ¸…æ¥šçš„æ˜¯åˆ°åº•ä»€ä¹ˆæ˜¯<code>move</code>ä»¥åŠä¸ºä»€ä¹ˆæœ‰äº›æƒ…å†µæˆ‘ä»¬è¦é˜²æ­¢<code>move</code>å‘ç”Ÿï¼Ÿ</p>
<h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯move"><a class="header" href="#åˆ°åº•ä»€ä¹ˆæ˜¯move">åˆ°åº•ä»€ä¹ˆæ˜¯moveï¼Ÿ</a></h2>
<p>æ ¹æ®å®˜æ–¹å®šä¹‰ï¼šæ‰€æœ‰æƒè½¬ç§»çš„è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯<code>move</code>ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå¤§å®¶éƒ½éå¸¸ç†Ÿæ‚‰çš„ä¾‹å­ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
  let mut s1 = String::from(&quot;Hello&quot;);
  let s2 = s1; // s1çš„æ‰€æœ‰æƒè½¬ç§»ç»™äº†s2ï¼Œè¿™é‡Œå‘ç”Ÿäº†move
  // let s3 = s1; // s1çš„æ‰€æœ‰æƒä»¥åŠè½¬ç§»èµ°äº†ï¼Œä¸èƒ½å†moveï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šerror[E0382]: use of moved value: `s1`
}
</code></pre></pre>
<p>åŸºæœ¬æ¦‚å¿µè¿™é‡Œä¸å¤šè§£é‡Šäº†ï¼Œæˆ‘ä»¬éœ€è¦ææ˜ç™½çš„æ˜¯<code>let s2 = s1;</code>è¿™ä¸€è¡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<p><img src="./img/trpl04-04.svg" alt="trpl04-04" /></p>
<p>å€Ÿç”¨äº† TRPL ä¹¦ä¸Šçš„è¿™å¼ å›¾ã€‚<code>s1</code>å’Œ<code>s2</code>ä¸¤ä¸ªå˜é‡éƒ½æ˜¯åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ï¼Œå­—ç¬¦ä¸² â€œHelloâ€ æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå…¶ä¸­<code>ptr</code>å­—æ®µå°±æ˜¯æŒ‡å‘è¯¥å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚<code>move</code>å‘ç”Ÿçš„æ—¶å€™ç¼–è¯‘å™¨ä¼šåœ¨æ ˆä¸Šå¼€è¾Ÿä¸€å—æ–°å†…å­˜<code>s2</code>ï¼Œç„¶ååŸå°ä¸åŠ¨æŠŠ<code>s1</code>æ ˆä¸Šçš„å†…å®¹æ‹·è´åˆ°<code>s2</code>ï¼Œéšå³ç«‹é©¬è®©åŸ<code>s1</code>çš„å†…å­˜å¤±æ•ˆã€‚</p>
<p>å†çœ‹ä¸€ä¸ª move çš„åˆ—å­ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut x = String::from(&quot;xxx&quot;);
    let mut y = String::from(&quot;yyy&quot;);

    std::mem::swap(&amp;mut x, &amp;mut y);

    assert_eq!(&quot;yyy&quot;, &amp;x);
    assert_eq!(&quot;xxx&quot;, &amp;y);
}
</code></pre></pre>
<p>æˆ‘ä»¬é€šè¿‡<code>std::mem::swap()</code>æ–¹æ³•äº¤æ¢äº†ä¸¤ä¸ªå¯å˜å€Ÿç”¨<code>&amp;mut</code>çš„å†…å®¹ï¼Œè¿™é‡Œä¹Ÿå‘ç”Ÿäº†<code>move</code>ã€‚</p>
<p>åƒè¿™ä¸¤ç§<code>move</code>åœ¨ Rust é‡Œé¢å¾ˆç¨€æ¾å¹³å¸¸ï¼Œä½¿ç”¨èµ·æ¥ä¸æ¯«ä¸ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜ã€‚é‚£åˆ°åº•æ˜¯ä»€ä¹ˆæƒ…å†µéœ€è¦é˜²æ­¢<code>move</code>çš„å‘ç”Ÿå‘¢ï¼Ÿ</p>
<p>è¿˜çœŸæœ‰ï¼Œé‚£å°±æ˜¯è‡ªå¼•ç”¨ç»“æ„ä½“ï¼</p>
<h2 id="è‡ªå¼•ç”¨ç»“æ„ä½“çš„-move"><a class="header" href="#è‡ªå¼•ç”¨ç»“æ„ä½“çš„-move">è‡ªå¼•ç”¨ç»“æ„ä½“çš„ move</a></h2>
<p>è‡ªå¼•ç”¨ç»“æ„ä½“ (Self-Referential Structs) æ˜¯ä¸€ä¸ªè¿™ä¸ªæ ·çš„ç»“æ„ä½“ï¼Œå®ƒå†…éƒ¨æŸä¸ªæˆå‘˜æ˜¯å¯¹å¦å¤–ä¸€ä¸ªæˆå‘˜çš„å¼•ç”¨ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><pre class="playground"><code class="language-rust">struct Test&lt;'a&gt; {
    a: String,
    b: &amp;'a String,
}

fn main() {
    let a = String::from(&quot;Hello&quot;);
    let _test = Test { a, b: &amp;a };
//    let _test = Test { a, b: &amp;a };
//  |                        -     ^^ value borrowed here after move
//  |                        |
//  |                        value moved here
}
</code></pre></pre>
<p>ä½†äº‹å®ä¸Šæˆ‘ä»¬æ²¡åŠæ³•é€šè¿‡<code>Safe Rust</code>æ„é€ ä¸€ä¸ªåƒ Test è¿™æ ·çš„è‡ªå¼•ç”¨ç»“æ„ä½“ï¼ŒRust ç›®å‰å¯¹è‡ªå¼•ç”¨ç»“æ„ä½“æ”¯æŒè¿˜å¾ˆä¸å®Œå–„ã€‚åªèƒ½å˜é€šä¸€ä¸‹ä½¿ç”¨æŒ‡é’ˆï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug)]
struct Test {
    a: String,
    b: *const String, // æ”¹æˆæŒ‡é’ˆ
}

impl Test {
    fn new(txt: &amp;str) -&gt; Self {
        Test {
            a: String::from(txt),
            b: std::ptr::null(),
        }
    }

    fn init(&amp;mut self) {
        let self_ref: *const String = &amp;self.a;
        self.b = self_ref;
    }

    fn a(&amp;self) -&gt; &amp;str {
        &amp;self.a
    }

    fn b(&amp;self) -&gt; &amp;String {
        unsafe {&amp;*(self.b)}
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹è¿™ä¸ªè‡ªå¼•ç”¨ç»“æ„ä½“çš„ moveï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut test1 = Test::new(&quot;test1&quot;);
    test1.init();
    let mut test2 = Test::new(&quot;test2&quot;);
    test2.init();

    println!(&quot;a: {}, b: {}&quot;, test1.a(), test1.b());
    // ä½¿ç”¨swap()å‡½æ•°äº¤æ¢ä¸¤è€…ï¼Œè¿™é‡Œå‘ç”Ÿäº†move
    std::mem::swap(&amp;mut test1, &amp;mut test2);
    test1.a = &quot;I've totally changed now!&quot;.to_string();
    println!(&quot;a: {}, b: {}&quot;, test2.a(), test2.b());
}
</code></pre></pre>
<p>è¿™æ˜¯æ‰“å°ç»“æœï¼š</p>
<pre><code class="language-console">a: test1, b: test1
a: test1, b: I've totally changed now!
</code></pre>
<p>æœ‰æ²¡æœ‰å‘ç°ï¼Œå‡ºé—®é¢˜äº†ï¼é—®é¢˜å‡ºåœ¨å“ªï¼ŸåŸå› æ˜¯ Test ç»“æ„ä½“ä¸­çš„å­—æ®µ b æ˜¯ä¸€ä¸ªæŒ‡å‘å­—æ®µ a çš„æŒ‡é’ˆï¼Œå®ƒåœ¨æ ˆä¸Šå­˜çš„æ˜¯å­—æ®µ a çš„åœ°å€ã€‚é€šè¿‡<code>swap()</code>å‡½æ•°äº¤æ¢ä¸¤ä¸ª Test ç»“æ„ä½“ä¹‹åï¼Œå­—æ®µ a, b åˆ†åˆ«ç§»åŠ¨åˆ°å¯¹æ–¹çš„å†…å­˜åŒºåŸŸä¸Šï¼Œä½†æ˜¯ a å’Œ b æœ¬èº«çš„å†…å®¹æ²¡æœ‰å˜ã€‚ä¹Ÿå°±æ˜¯æŒ‡é’ˆ b ä¾ç„¶æŒ‡å‘çš„æ˜¯åŸæ¥çš„åœ°å€ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€ç°åœ¨å·²ç»å±äºå¦å¤–ä¸€ä¸ªç»“æ„ä½“äº†ï¼è¿™ä¸ä»…ä¸æ˜¯è‡ªå¼•ç”¨ç»“æ„ä½“äº†ï¼Œæ›´å¯æ€•çš„æ˜¯è¿™ä¸ªæŒ‡é’ˆå¯èƒ½å¯¼è‡´æ›´å±é™©çš„é—®é¢˜ï¼Œè¿™æ˜¯ Rust å†³ä¸å…è®¸å‡ºç°çš„ï¼ğŸ‘‡ä¸‹é¢è¿™å¼ å›¾å¯ä»¥å¸®åŠ©ç†è§£ï¼š</p>
<p><img src="./img/swap_problem.jpeg" alt="swap_problem" /></p>
<p>æ›´å…³é”®çš„æ˜¯ Rust çš„<code>Generator</code>å’Œ<code>async/await</code>è¿™ä¸€å¥—éƒ½æ˜¯åŸºäºè‡ªå¼•ç”¨ç»“æ„ä½“å®ç°çš„ã€‚å¦‚æœä¸èƒ½ä»æ ¹æºä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRust å·ç§°çš„<code>Memory Safe</code>çš„æ ¹åŸºå°±å®Œå…¨åŠ¨æ‘‡äº†ã€‚</p>
<blockquote>
<p>æ›´å¤šå…³äºasync/awaitçš„åŸç†ï¼Œå¼ºçƒˆæ¨èé˜…è¯»è¿™ä¸¤æœ¬ä¹¦ï¼š</p>
<ul>
<li>https://rust-lang.github.io/async-book</li>
<li>https://cfsamson.github.io/books-futures-explained</li>
</ul>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬æ¥æ‰¾ä¸€ä¸‹å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„æ ¹æºï¼Œç„¶åæƒ³åŠæ³•ä»æ ¹æºä¸Šè§£å†³å®ƒï¼</p>
<h2 id="æ ¹æºæ˜¯ä»€ä¹ˆ"><a class="header" href="#æ ¹æºæ˜¯ä»€ä¹ˆ">æ ¹æºæ˜¯ä»€ä¹ˆï¼Ÿ</a></h2>
<p>æˆ‘ä»¬å‘ç°ä¸Šé¢çš„ä¾‹å­æœ€å…³é”®çš„ä¸€è¡Œä»£ç æ˜¯<code>std::mem::swap(&amp;mut test1, &amp;mut test2)</code>ï¼Œå°±æ˜¯å®ƒå¯¼è‡´äº†æˆ‘ä»¬è‡ªå¼•ç”¨ç»“æ„ä½“å¤±æ•ˆå¼•å‘äº†å†…å­˜å®‰å…¨é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬æ˜¯ä¸æ˜¯åªè¦é¿å…è¿™ä¸ª<code>swap()</code>å‡½æ•°åº”ç”¨åˆ°æˆ‘ä»¬è‡ªå¼•ç”¨ç»“æ„ä½“ä¸Šå°±è¡Œï¼Ÿå¯æ˜¯æ€ä¹ˆå»é¿å…å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>swap()</code>æ–¹æ³•çš„å®šä¹‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[inline]
#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
pub fn swap&lt;T&gt;(x: &amp;mut T, y: &amp;mut T) {
    // SAFETY: the raw pointers have been created from safe mutable references satisfying all the
    // constraints on `ptr::swap_nonoverlapping_one`
    unsafe {
        ptr::swap_nonoverlapping_one(x, y);
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>å®ƒçš„å‚æ•°è¦æ±‚æ˜¯å¯å˜å€Ÿç”¨<code>&amp;mut</code>ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æƒ³åŠæ³•è®©<code>Safe Rust</code>ä¸‹ä¸æš´éœ²å¯å˜å€Ÿç”¨å³å¯ï¼</p>
<p>è¿˜æ˜¯ä»¥ Test ä¸ºä¾‹ï¼Œå®ƒè‡ªèº«æ²¡åŠæ³•é™åˆ¶è‡ªå·±ä¸èƒ½å¯å˜å€Ÿç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ç”¨<code>&amp;mut Test{...}</code>å°±å¯ä»¥è½»æ¾æ‹¿åˆ°ã€‚é‚£ä»æ ‡å‡†åº“ä¸­å»æ‰¾æ‰¾ï¼Œ<code>Box&lt;T&gt;</code>å‘¢ï¼Ÿå…ˆä¸è€ƒè™‘å®ƒæ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬æŠŠç»“æ„ä½“ T åŒ…è£¹åœ¨<code>Box</code>ä¸­ï¼Œçœ‹<code>Box</code>èƒ½ä¸èƒ½ä¿è¯ä¸æš´éœ²<code>&amp;mut T</code>å‡ºå»ã€‚çœ‹ä¸€ä¸‹ API æ–‡æ¡£ï¼Œå¾ˆé—æ†¾ä¸èƒ½ã€‚<code>Box::leak()</code>è¿”å›å€¼å°±æ˜¯&amp;mut Tï¼Œæ›´ç”šè€…<code>Box</code> impl äº†<code>DerefMut</code>ï¼Œå°±ç®—ä¸ç”¨<code>leak()</code>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>* &amp;mut Box&lt;T&gt;</code>è§£å¼•ç”¨è½»æ¾æ‹¿åˆ°<code>&amp;mut T</code>ï¼</p>
<p>ä¸ç”¨æ‰¾äº†ï¼Œåœ¨<code>Pin</code>ä¹‹å‰çš„æ ‡å‡†åº“ä¸­ç¡®å®æ²¡æœ‰è¿™æ ·çš„ API èƒ½å¤Ÿé˜²æ­¢åœ¨<code>Safe Rust</code>ä¸‹ä¸æš´éœ²<code>&amp;mut T</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æ˜¯è¯¥<code>Pin</code>ç™»åœºçš„æ—¶å€™äº†ï¼</p>
<h2 id="pin-é—ªäº®ç™»åœº"><a class="header" href="#pin-é—ªäº®ç™»åœº">Pin é—ªäº®ç™»åœº</a></h2>
<p>æˆ‘ä»¬æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æºåœ¨å“ªï¼Œ<code>Pin</code>å°±æ˜¯ä»æ ¹æºä¸Šè§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚ç°åœ¨æˆ‘ä»¬å¾ˆæ¸…æ™°äº†ï¼Œä¼¼ä¹æ˜¯ä¸æ˜¯å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼š<code>Pin</code>å°±æ˜¯ä¸€ä¸ªä¸ä¼šè®©ä½ åœ¨<code>Safe Rust</code>æš´éœ²å¯å˜å€Ÿç”¨<code>&amp;mut</code>çš„æ™ºèƒ½æŒ‡é’ˆ?</p>
<p>ç­”æ¡ˆæ˜¯ï¼šä¸å…¨æ­£ç¡®ã€‚è¿™å°±æ˜¯<code>Pin</code>æ¦‚å¿µèµ·åˆè®©å¤§å®¶ä¸€è„¸æ‡µé€¼çš„åœ°æ–¹ã€‚ä¸‹é¢è®©<code>Pin</code>è‡ªå·±æ¥è§£ç­”å¤§å®¶çš„ç–‘æƒ‘ï¼Œ<code>Pin</code>è¯´ï¼šâ€œä½ ä»¬ä¸æ˜¯æƒ³è®©æˆ‘ä¿è¯è¢«æˆ‘åŒ…è£¹çš„æŒ‡é’ˆ<code>P&lt;T&gt;</code>æ°¸è¿œé’‰ä½ä¸è®©<code>move</code>å—ï¼Ÿæˆ‘å¯ä»¥ç­”åº”ï¼Œä½†æˆ‘æœ‰ä¸€ä¸ªåŸåˆ™ã€‚é‚£å°±æ˜¯æˆ‘æ°¸è¿œä¸èƒ½é’‰ä½æŒæœ‰é€šè¡Œè¯çš„æœ‹å‹ï¼Œè¿™å¼ é€šè¡Œè¯å°±æ˜¯<code>Unpin</code>ã€‚å¦‚æœæ²¡æœ‰è¿™å¼ é€šè¡Œè¯ï¼Œè¯·æ”¾å¿ƒï¼Œæˆ‘ä¼šæŠŠä½ é’‰å¾—æ­»æ­»çš„ï¼â€</p>
<p>ä¸¾ä¸ªä¾‹å­ã€‚æ¯”å¦‚æˆ‘æ˜¯<code>Pin</code>ï¼Œä½ æ˜¯<code>P&lt;T&gt;</code>ï¼Œå¦‚æœä½  impl äº†<code>Unpin</code>ï¼Œæˆ‘ä¼šæä¾›ä¸¤ç§åŠæ³•è®©ä½ åœ¨<code>Safe Rust</code>ä¸‹æ‹¿åˆ°<code>&amp;mut T</code>ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼Œä½¿ç”¨ï¼š<code>Pin::get_mut()</code></li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;'a, T: ?Sized&gt; Pin&lt;&amp;'a mut T&gt; {
    #[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
    #[inline(always)]
    pub fn get_mut(self) -&gt; &amp;'a mut T where T: Unpin {
        self.pointer
    }
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>ç¬¬äºŒç§ï¼Œæˆ‘ impl äº†<code>DerefMut</code>ï¼Œä½ å¯ä»¥è§£å¼•ç”¨æ‹¿åˆ°<code>&amp;mut T</code></li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl&lt;P: DerefMut&lt;Target: Unpin&gt;&gt; DerefMut for Pin&lt;P&gt; {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut P::Target {
        Pin::get_mut(Pin::as_mut(self))
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>å¯<code>rustc</code>çˆ¸çˆ¸å¤ªå®½å®¹äº†ï¼Œä»–é»˜è®¤ç»™ä½ ä»¬æ‰€æœ‰ç±»å‹å‘äº†é€šè¡Œè¯ï¼ˆéƒ½å®ç°äº†<code>Unpin</code>ï¼‰ï¼æå¾—æˆ‘éƒ½å‡ ä¹å¿«è¦å¤±ä¸šäº†ï¼</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[lang = &quot;unpin&quot;]
pub auto trait Unpin {}

#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl&lt;'a, T: ?Sized + 'a&gt; Unpin for &amp;'a T {}

#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl&lt;'a, T: ?Sized + 'a&gt; Unpin for &amp;'a mut T {}

#[stable(feature = &quot;pin_raw&quot;, since = &quot;1.38.0&quot;)]
impl&lt;T: ?Sized&gt; Unpin for *const T {}

#[stable(feature = &quot;pin_raw&quot;, since = &quot;1.38.0&quot;)]
impl&lt;T: ?Sized&gt; Unpin for *mut T {}
<span class="boring">}
</span></code></pre></pre>
<p>å”¯ä¸€è®©æˆ‘æ¬£æ…°çš„æ˜¯ï¼Œä»–ç»™æˆ‘ç•™äº†ä¸€ä¸ªå«<code>PhantomPinned</code>çš„å°ä¼™ä¼´ã€‚åˆ«çœ‹ä»–åå­—å¾ˆå¥‡æ€ªï¼Œä»–å¯æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„å¾—åŠ›åŠ©æ‰‹ï¼å› ä¸ºä»–å®ç°çš„æ˜¯<code>!Unpin</code>ï¼</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
#[derive(Debug, Copy, Clone, Eq, PartialEq, Ord, PartialOrd, Hash)]
pub struct PhantomPinned;

#[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
impl !Unpin for PhantomPinned {}
<span class="boring">}
</span></code></pre></pre>
<p><code>rustc</code>çˆ¸çˆ¸è¿˜è¯´ï¼Œä½ ä»¬å¦‚æœæƒ³â€œæ”¹é‚ªå½’æ­£â€å»æ‰<code>Unpin</code>ä¹Ÿå¯ä»¥ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>PhantomPinned</code>ã€‚æœ‰äº†å®ƒï¼Œ<code>rustc</code>çˆ¸çˆ¸ä¸ä¼šè®©ä½ å®ç°<code>Unpin</code>ã€‚</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::marker::PhantomPinned;

#[derive(Debug)]
struct Test {
   a: String,
   b: *const String,
   _marker: PhantomPinned,
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>å¾—è‡ªå·±æ‰‹åŠ¨impl <code>!Unpin</code>ã€‚å‰ææ˜¯ä½ è¦ä½¿ç”¨<code>nightly</code>ç‰ˆæœ¬ï¼Œå¹¶ä¸”éœ€è¦å¼•å…¥<code>#![feature(negative_impls)]</code>ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span>#![feature(negative_impls)]
<span class="boring">fn main() {
</span>#[derive(Debug)]
struct Test {
    a: String,
    b: *const String,
}

impl !Unpin for Test {}
<span class="boring">}
</span></code></pre></pre>
<p>æ»¡è¶³ä»¥ä¸Šä»»æ„ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€çš„è¯ï¼Œæˆ‘å°±ä¼šä¿è¯ä½ æ²¡åŠæ³•åœ¨<code>Safe Rust</code>ä¸‹æ‹¿åˆ°å¯å˜å€Ÿç”¨<code>&amp;mut T</code>ï¼ˆä¸ä¿¡ä½ å»ç¿»ç¿»æˆ‘çš„ APIï¼‰ï¼Œæ‹¿ä¸åˆ°<code>&amp;mut T</code>ä½ å°±æ²¡åŠæ³•ä½œç”¨åˆ°<code>std::mem::swap()</code>ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä½ è¢«æˆ‘é’‰ä½äº†ï¼ä½ ä»¥ä¸º<code>rustc</code>çˆ¸çˆ¸ç»™æˆ‘æ–½äº†é­”æ³•ä¹ˆï¼Ÿä½ é”™äº†ï¼Œæˆ‘çš„å·¥ä½œåŸç†å°±æ˜¯è¿™ä¹ˆç®€å•ï¼æ„Ÿè°¢ Rust ä¸–ç•Œä¸°å¯Œè€Œå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œæˆ‘çš„å…¶ä»–å…„å¼Ÿ<code>Sync</code>ï¼Œ<code>Send</code>ä¹Ÿæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬éƒ½æ²¡æœ‰æ‰€è°“çš„é­”æ³•ï¼</p>
<p>å½“ç„¶æˆ‘è¿˜æ˜¯æä¾›äº†ä¸€ä¸ª<code>unsafe</code>çš„<code>get_unchecked_mut()</code>ï¼Œä¸ç®¡ä½ æœ‰æ²¡æœ‰å®ç°<code>Unpin</code>ï¼Œä½ éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ‹¿åˆ°<code>&amp;mut T</code>ï¼Œä½†æ˜¯ä½ éœ€è¦éµå®ˆ<code>Pin</code>çš„å¥‘çº¦ï¼ˆå‚è€ƒä¸‹é¢ï¼‰ï¼Œå¦åˆ™å‡ºäº†ä»€ä¹ˆé—®é¢˜åæœè‡ªè´Ÿï¼</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;'a, T: ?Sized&gt; Pin&lt;&amp;'a mut T&gt; {
    #[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
    #[inline(always)]
    pub unsafe fn get_unchecked_mut(self) -&gt; &amp;'a mut T {
        self.pointer
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="pinçš„å¥‘çº¦"><a class="header" href="#pinçš„å¥‘çº¦">Pinçš„å¥‘çº¦ï¼š</a></h3>
<blockquote>
<p>å¯¹äº<code>Pin&lt;P&lt;T&gt;&gt;</code>ï¼Œ</p>
<ul>
<li>å¦‚æœ<code>P&lt;T&gt;</code>ç¬¦åˆ<code>Unpin</code>ï¼Œé‚£<code>P&lt;T&gt;</code>ä»è¢«<code>Pin</code>åŒ…è£¹åˆ°è¢«é”€æ¯ï¼Œéƒ½è¦ä¸€ç›´ä¿è¯<code>P&lt;T&gt;</code>ä¸è¢«é’‰ä½</li>
<li>å¦‚æœ<code>P&lt;T&gt;</code>ç¬¦åˆ<code>!Unpin</code>ï¼Œé‚£<code>P&lt;T&gt;</code>ä»è¢«<code>Pin</code>åŒ…è£¹åˆ°è¢«é”€æ¯ï¼Œéƒ½è¦ä¸€ç›´ä¿è¯<code>P&lt;T&gt;</code>è¢«é’‰ä½</li>
</ul>
</blockquote>
<p>é€šè¿‡ä»¥ä¸Š<code>Pin</code>çš„è‡ªè¿°ï¼Œæˆ‘ä»¬å†ç”¨ä¸€å¥è¯æ¥æ€»ç»“ï¼šå¦‚æœä½ å®ç°äº†<code>Unpin</code>ï¼Œ<code>Pin</code>å¯ä»¥è®©ä½ åœ¨<code>Safe Rust</code>ä¸‹æ‹¿åˆ°<code>&amp;mut T</code>ï¼Œå¦åˆ™ä¼šæŠŠä½ åœ¨<code>Safe Rust</code>ä¸‹é’‰ä½(ä¹Ÿå°±æ˜¯æ‹¿ä¸åˆ°<code>&amp;mut T</code>)ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨<code>Pin</code>æ¥ä¿®å¤ä¸€ä¸‹ä¸Šé¢è‡ªå¼•ç”¨ç»“æ„ä½“çš„é—®é¢˜ã€‚</p>
<h2 id="å¦‚ä½•æ„é€ ä¸€ä¸ª-pin"><a class="header" href="#å¦‚ä½•æ„é€ ä¸€ä¸ª-pin">å¦‚ä½•æ„é€ ä¸€ä¸ª Pin</a></h2>
<p>é¦–å…ˆæˆ‘ä»¬è¦æ¢³ç†æ¸…æ¥šæ€æ ·æŠŠ<code>P&lt;T&gt;</code>ç”¨<code>Pin</code>åŒ…è£¹èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯æ€æ ·æ„é€ ä¸€ä¸ª<code>Pin</code>ã€‚æŸ¥çœ‹æ–‡æ¡£ä¼šå‘ç°ä¸»è¦æœ‰è¿™å‡ ç§æ–¹å¼ï¼š</p>
<h3 id="pinnew"><a class="header" href="#pinnew">Pin::new()</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;P: Deref&lt;Target: Unpin&gt;&gt; Pin&lt;P&gt; {
    #[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
    #[inline(always)]
    pub fn new(pointer: P) -&gt; Pin&lt;P&gt; {
        // Safety: the value pointed to is `Unpin`, and so has no requirements
        // around pinning.
        unsafe { Pin::new_unchecked(pointer) }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>å¦‚æœä½ çš„ P æŒ‡å‘çš„ T æ˜¯<code>Unpin</code>çš„è¯ï¼Œä½ å¯ä»¥å®‰å…¨çš„è°ƒç”¨<code>Pin::new()</code>æ„é€ ä¸€ä¸ª<code>Pin</code>ã€‚å¯ä»¥çœ‹åˆ°å®ƒåº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨<code>unsafe</code>çš„<code>Pin::new_unchecked()</code>ï¼Œä¹‹æ‰€ä»¥<code>Pin::new()</code>æ˜¯å®‰å…¨çš„ï¼Œæ˜¯å› ä¸º<code>Unpin</code>çš„æƒ…å†µä¸‹<code>Pin</code>çš„â€é’‰ä½â€œæ•ˆæœæ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œè·Ÿæ­£å¸¸çš„æŒ‡é’ˆä¸€æ ·äº†ã€‚</p>
<h3 id="pinnew_unchecked"><a class="header" href="#pinnew_unchecked">Pin::new_unchecked()</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;P: Deref&gt; Pin&lt;P&gt; {
    #[stable(feature = &quot;pin&quot;, since = &quot;1.33.0&quot;)]
    #[inline(always)]
    pub unsafe fn new_unchecked(pointer: P) -&gt; Pin&lt;P&gt; {
        Pin { pointer }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œä½†å®ƒæ˜¯<code>unsafe</code>çš„ã€‚æ ‡ä¸º<code>unsafe</code>çš„åŸå› æ˜¯ç¼–è¯‘å™¨æ²¡åŠæ³•ä¿è¯ä½¿ç”¨è€…åç»­æ“ä½œä¸€å®šéµå®ˆ<code>Pin</code>çš„å¥‘çº¦ã€‚åªè¦æœ‰å­˜åœ¨è¿åå¥‘çº¦çš„å¯èƒ½æ€§ï¼Œå°±å¿…é¡»ç”¨<code>unsafe</code>æ ‡è®°ï¼Œå› ä¸ºè¿™æ˜¯ä½¿ç”¨è€…çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨æ²¡åŠæ³•ä¿è¯ã€‚å¦‚æœä½¿ç”¨è€…é€šè¿‡<code>Pin::new_unchecked()</code>æ„é€ ä¸€ä¸ª<code>Pin&lt;P&lt;T&gt;&gt;</code>ä¹‹å<code>Pin</code>çš„ç”Ÿå‘½å‘¨æœŸç»“æŸäº†ï¼Œä½†<code>P&lt;T&gt;</code>ä¾ç„¶å­˜åœ¨ï¼Œåˆ™åç»­æ“ä½œä¾ç„¶å¯èƒ½è¢«<code>move</code>ï¼Œé€ æˆå†…å­˜ä¸å®‰å…¨ã€‚</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::mem;
use std::pin::Pin;

fn move_pinned_ref&lt;T&gt;(mut a: T, mut b: T) {
    unsafe {
        let p: Pin&lt;&amp;mut T&gt; = Pin::new_unchecked(&amp;mut a);
        // This should mean the pointee `a` can never move again.
    }
    mem::swap(&amp;mut a, &amp;mut b);
    // The address of `a` changed to `b`'s stack slot, so `a` got moved even
    // though we have previously pinned it! We have violated the pinning API contract.
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="å…¶ä»–"><a class="header" href="#å…¶ä»–">å…¶ä»–</a></h3>
<p>åŒ…æ‹¬<code>Box::pin()</code>ï¼Œ<code>Rc::pin()</code>å’Œ<code>Arc::pin()</code>ç­‰ï¼Œåº•å±‚éƒ½æ˜¯è°ƒç”¨ä¸Šé¢çš„<code>Pin::new_unchecked()</code>ï¼Œä¸å†é˜è¿°ã€‚</p>
<h2 id="pin-çš„åº”ç”¨"><a class="header" href="#pin-çš„åº”ç”¨">Pin çš„åº”ç”¨</a></h2>
<p><code>Pin</code>å¯ä»¥åˆ†ä¸ºæ ˆä¸Šè¿˜æ˜¯å †ä¸Šï¼Œå–å†³äºä½ è¦<code>Pin</code>çš„é‚£ä¸ªæŒ‡é’ˆ P æ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šã€‚æ¯”å¦‚<code>Pin&lt;&amp;mut T&gt;</code>æ˜¯æ ˆä¸Šï¼Œ<code>Pin&lt;Box&lt;T&gt;&gt;</code>æ˜¯åœ¨å †ä¸Šã€‚</p>
<h3 id="pin-åˆ°æ ˆä¸Š"><a class="header" href="#pin-åˆ°æ ˆä¸Š">Pin åˆ°æ ˆä¸Š</a></h3>
<pre><pre class="playground"><code class="language-rust">use std::marker::PhantomPinned;

#[derive(Debug)]
struct Test {
    a: String,
    b: *const String,
    _marker: PhantomPinned,
}

impl Test {
    fn new(txt: &amp;str) -&gt; Self {
        Test {
            a: String::from(txt),
            b: std::ptr::null(),
            _marker: PhantomPinned, // This makes our type `!Unpin`
        }
    }

    fn init&lt;'a&gt;(self: Pin&lt;&amp;'a mut Self&gt;) {
        let self_ptr: *const String = &amp;self.a;
        let this = unsafe { self.get_unchecked_mut() };
        this.b = self_ptr;
    }

    fn a&lt;'a&gt;(self: Pin&lt;&amp;'a Self&gt;) -&gt; &amp;'a str {
        &amp;self.get_ref().a
    }

    fn b&lt;'a&gt;(self: Pin&lt;&amp;'a Self&gt;) -&gt; &amp;'a String {
        unsafe { &amp;*(self.b) }
    }
}

pub fn main() {
    let mut test1 = unsafe { Pin::new_unchecked(&amp;mut Test::new(&quot;test1&quot;)) };
    Test::init(test1.as_mut());

    let mut test2 = unsafe { Pin::new_unchecked(&amp;mut Test::new(&quot;test2&quot;)) };
    Test::init(test2.as_mut());

    println!(&quot;a: {}, b: {}&quot;, Test::a(test1.as_ref()), Test::b(test1.as_ref()));
    std::mem::swap(test1.get_mut(), test2.get_mut());
    println!(&quot;a: {}, b: {}&quot;, Test::a(test2.as_ref()), Test::b(test2.as_ref()));
}
</code></pre></pre>
<p>æˆ‘ä»¬å°è¯•æŠŠ<code>&amp;mut Test</code>é’‰åœ¨æ ˆä¸Šï¼Œç„¶åå°è¯•å»è°ƒç”¨<code>get_mut()</code>ä½œä¸ºå‚æ•°ä¼ ç»™<code>std::mem::swap()</code>ï¼Œå‘ç°ç¼–è¯‘ä¸é€šè¿‡ã€‚Rust ç¼–è¯‘å™¨ä»ç¼–è¯‘é˜¶æ®µå°±é˜»æ­¢æˆ‘ä»¬å»çŠ¯é”™äº†ã€‚</p>
<pre><code class="language-console">|     std::mem::swap(test1.get_mut(), test2.get_mut());
  |                          ^^^^^^^ within `Test`, the trait `Unpin` is not implemented for `PhantomPinned`
  |
</code></pre>
<h3 id="pin-åˆ°å †ä¸Š"><a class="header" href="#pin-åˆ°å †ä¸Š">Pin åˆ°å †ä¸Š</a></h3>
<pre><pre class="playground"><code class="language-rust">use std::pin::Pin;
use std::marker::PhantomPinned;

#[derive(Debug)]
struct Test {
    a: String,
    b: *const String,
    _marker: PhantomPinned,
}

impl Test {
    fn new(txt: &amp;str) -&gt; Pin&lt;Box&lt;Self&gt;&gt; {
        let t = Test {
            a: String::from(txt),
            b: std::ptr::null(),
            _marker: PhantomPinned,
        };
        let mut boxed = Box::pin(t);
        let self_ptr: *const String = &amp;boxed.as_ref().a;
        unsafe { boxed.as_mut().get_unchecked_mut().b = self_ptr };

        boxed
    }

    fn a&lt;'a&gt;(self: Pin&lt;&amp;'a Self&gt;) -&gt; &amp;'a str {
        &amp;self.get_ref().a
    }

    fn b&lt;'a&gt;(self: Pin&lt;&amp;'a Self&gt;) -&gt; &amp;'a String {
        unsafe { &amp;*(self.b) }
    }
}

pub fn main() {
    let mut test1 = Test::new(&quot;test1&quot;);
    let mut test2 = Test::new(&quot;test2&quot;);

    println!(&quot;a: {}, b: {}&quot;,test1.as_ref().a(), test1.as_ref().b());
    // std::mem::swap(test1.get_mut(), test2.get_mut());
    // std::mem::swap(&amp;mut *test1, &amp;mut *test2);
    println!(&quot;a: {}, b: {}&quot;,test2.as_ref().a(), test2.as_ref().b());
}
</code></pre></pre>
<p>è¿™é‡Œä½¿ç”¨<code>Box::pin()</code>æŠŠ Test é’‰åœ¨äº†å †ä¸Šã€‚å–æ¶ˆæ³¨é‡Šä»»æ„ä¸€è¡Œéƒ½ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œå› ä¸º Test æ˜¯<code>!Unpin</code>çš„ã€‚</p>
<h2 id="future"><a class="header" href="#future">Future</a></h2>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[stable(feature = &quot;futures_api&quot;, since = &quot;1.36.0&quot;)]
pub trait Future {
    type Output;
    fn poll(self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context&lt;'_&gt;) -&gt; Poll&lt;Self::Output&gt;;
}
<span class="boring">}
</span></code></pre></pre>
<p>æ¥ä¸‹æ¥è®²ä¸€ä¸‹<code>Pin</code>ç›®å‰æœ€é‡è¦çš„ä¸€ä¸ªåº”ç”¨ï¼š<code>Future</code>ã€‚å½“åˆ 2018 å¹´å®˜æ–¹å¼‚æ­¥ç»„å¼•å…¥<code>Pin</code> APIçš„åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³<code>Future</code>å†…éƒ¨è‡ªå¼•ç”¨çš„é—®é¢˜ã€‚å› ä¸º<code>async/await</code>å°±æ˜¯é€šè¿‡<code>Generator</code>å®ç°çš„ï¼Œ<code>Generator</code>æ˜¯é€šè¿‡åŒ¿åç»“æ„ä½“å®ç°çš„ã€‚å¦‚æœ<code>async</code>å‡½æ•°ä¸­å­˜åœ¨è·¨<code>await</code>çš„å¼•ç”¨ï¼Œä¼šå¯¼è‡´åº•å±‚<code>Generator</code>å­˜åœ¨è·¨<code>yield</code>çš„å¼•ç”¨ï¼Œé‚£æ ¹æ®<code>Generator</code>ç”Ÿæˆçš„åŒ¿åç»“æ„ä½“å°±ä¼šæ˜¯ä¸€ä¸ªè‡ªå¼•ç”¨ç»“æ„ä½“ï¼ç„¶åè¿™ä¸ªè‡ªå¼•ç”¨ç»“æ„ä½“ä¼šimpl <code>Future</code>ï¼Œå¼‚æ­¥çš„<code>Runtime</code>åœ¨è°ƒç”¨<code>Future::poll()</code>å‡½æ•°æŸ¥è¯¢çŠ¶æ€çš„æ—¶å€™ï¼Œéœ€è¦ä¸€ä¸ªå¯å˜å€Ÿç”¨(å³<code>&amp;mut Self</code>)ã€‚å¦‚æœè¿™ä¸ª<code>&amp;mut Self</code>ä¸åŒ…è£¹åœ¨<code>Pin</code>é‡Œé¢çš„è¯ï¼Œå¼€å‘è€…è‡ªå·±impl <code>Future</code>å°±ä¼šåˆ©ç”¨<code>std::mem::swap()</code>ä¹‹ç±»çš„å‡½æ•°<code>move</code>æ‰<code>&amp;mut Self</code>ï¼æ‰€ä»¥è¿™å°±æ˜¯<code>Future</code>çš„<code>poll()</code>å¿…é¡»è¦ä½¿ç”¨<code>Pin&lt;&amp;mut Self&gt;</code>çš„åŸå› ã€‚</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// è¿™ä¸ªasyncå—ä¸­å­˜åœ¨è·¨awaitçš„å€Ÿç”¨ï¼
let mut fut = async {
    let to_borrow = String::from(&quot;Hello&quot;);
    let borrowed = &amp;to_borrow;
    SomeResource::some_task().await;
    println!(&quot;{} world!&quot;, borrowed);
};
<span class="boring">}
</span></code></pre></pre>
<p>å½“ç„¶è¿˜æœ‰éå¸¸é‡è¦çš„ä¸€ç‚¹ä¸èƒ½å¿˜äº†ï¼<code>Pin</code>åªå¯¹å®ç°<code>!Unpin</code>çš„ç±»å‹æ‰æœ‰é’‰ä½çš„æ•ˆæœï¼Œè¿™ä¸ªimpl <code>Future</code>çš„åŒ¿åç»“æ„ä½“æœ‰impl <code>!Unpin</code>å—ï¼Ÿå½“ç„¶æœ‰ï¼Œå‰é¢è¯´äº†åªæœ‰å‡ ç§ç‰¹ä¾‹æ˜¯é»˜è®¤<code>!Unpin</code>ï¼Œè¿™ä¸ªåŒ¿åç»“æ„ä½“å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub const fn from_generator&lt;T&gt;(gen: T) -&gt; impl Future&lt;Output = T::Return&gt;
where
    T: Generator&lt;ResumeTy, Yield = ()&gt;,
{
    #[rustc_diagnostic_item = &quot;gen_future&quot;]
    struct GenFuture&lt;T: Generator&lt;ResumeTy, Yield = ()&gt;&gt;(T);

    // We rely on the fact that async/await futures are immovable in order to create
    // self-referential borrows in the underlying generator.
    impl&lt;T: Generator&lt;ResumeTy, Yield = ()&gt;&gt; !Unpin for GenFuture&lt;T&gt; {}

    impl&lt;T: Generator&lt;ResumeTy, Yield = ()&gt;&gt; Future for GenFuture&lt;T&gt; {
        type Output = T::Return;
        fn poll(self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context&lt;'_&gt;) -&gt; Poll&lt;Self::Output&gt; {
            // SAFETY: Safe because we're !Unpin + !Drop, and this is just a field projection.
            let gen = unsafe { Pin::map_unchecked_mut(self, |s| &amp;mut s.0) };

            // Resume the generator, turning the `&amp;mut Context` into a `NonNull` raw pointer. The
            // `.await` lowering will safely cast that back to a `&amp;mut Context`.
            match gen.resume(ResumeTy(NonNull::from(cx).cast::&lt;Context&lt;'static&gt;&gt;())) {
                GeneratorState::Yielded(()) =&gt; Poll::Pending,
                GeneratorState::Complete(x) =&gt; Poll::Ready(x),
            }
        }
    }

    GenFuture(gen)
}
<span class="boring">}
</span></code></pre></pre>
<p>åˆ’é‡ç‚¹<code>impl &lt;T: Generator&lt;ResumeTy, Yield = ()&gt;&gt; !Unpin for GenFuture&lt;T&gt; {}</code>ï¼Œåªæœ‰äº²çœ¼æ‰€è§æ‰èƒ½è®©å¤§å®¶ä¿¡æœã€‚</p>
<h2 id="å…¶ä»–-1"><a class="header" href="#å…¶ä»–-1">å…¶ä»–</a></h2>
<p><code>Pin</code>é™¤äº†ä¸Šé¢è¿™äº›å†…å®¹å¤–è¿˜æœ‰å…¶ä»–å‡ ä¸ªæ¦‚å¿µï¼Œæ¯”å¦‚<code>Pin projection</code>ï¼Œ<code>Structural pin</code>å’Œ<code>Non-structural pin</code>ï¼Œç¬”è€…è‡ªå·±ç”¨çš„ä¹Ÿä¸å¤šï¼Œè¯¦ç»†å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£æˆ–æŸ¥é˜…å…¶ä»–èµ„æ–™ã€‚</p>
<p><a href="https://docs.rs/futures">futures-rs</a> ä¸­è¿˜æœ‰ä¸å°‘å’Œ<code>Pin</code>æœ‰å…³çš„ APIï¼Œå¦‚æœæ·±å…¥ä½¿ç”¨<code>futures-rs</code>çš„è¯ï¼Œä¸å¯é¿å…çš„éœ€è¦é¢‘ç¹çš„å’Œ<code>Pin</code>æ‰“äº¤é“ã€‚</p>
<p><img src="./img/futures-rs.png" alt="futures-rs" /></p>
<h2 id="æ€»ç»“"><a class="header" href="#æ€»ç»“">æ€»ç»“</a></h2>
<p>ä¸‹é¢æ˜¯æ‘˜æŠ„è‡ªå®˜æ–¹ <a href="https://github.com/rust-lang/async-book">Async Book</a> ä¸Šå…³äº<code>Pin</code>çš„é»„é‡‘8æ¡ä½œä¸ºæ€»ç»“ï¼Œè¿™äº›å‡ ä¹å°±æ˜¯<code>Pin</code> API çš„å…¨éƒ¨äº†ã€‚</p>
<blockquote>
<ul>
<li>If T: Unpin (which is the default), then Pin&lt;'a, T&gt; is entirely equivalent to &amp;'a mut T. in other words: Unpin means it's OK for this type to be moved even when pinned, so Pin will have no effect on such a type.</li>
<li>Getting a &amp;mut T to a pinned T requires unsafe if T: !Unpin.</li>
<li>Most standard library types implement Unpin. The same goes for most &quot;normal&quot; types you encounter in Rust. A Future generated by async/await is an exception to this rule.</li>
<li>You can add a !Unpin bound on a type on nightly with a feature flag, or by adding std::marker::PhantomPinned to your type on stable.</li>
<li>You can either pin data to the stack or to the heap.</li>
<li>Pinning a !Unpin object to the stack requires unsafe</li>
<li>Pinning a !Unpin object to the heap does not require unsafe. There is a shortcut for doing this using Box::pin.</li>
<li>For pinned data where T: !Unpin you have to maintain the invariant that its memory will not get invalidated or repurposed from the moment it gets pinned until when drop is called. This is an important part of the pin contract.</li>
</ul>
</blockquote>
<p>2018 å¹´ Rust å¼‚æ­¥ç»„çš„æ ¸å¿ƒæˆå‘˜ @withoutboats åœ¨ä»–ä¸ªäººåšå®¢åˆ†äº«äº†ç¨³å®š<code>async/await</code>çš„æ•´ä¸ªå¿ƒè·¯å†ç¨‹ï¼Œæ„Ÿè§‰è¿™ä¸€è·¯ä¹Ÿæ˜¯å……æ»¡æ›²æŠ˜ã€‚æ¯”å¦‚<code>Pin</code>åˆšå¼€å§‹è¿˜éœ€è¦åŒºåˆ†<code>Pin</code>ï¼Œ<code>PinMut</code>ï¼Œ<code>PinBox</code>ç­‰ï¼Œç°åœ¨ç²¾ç®€åˆ°åªéœ€è¦ä¸€ä¸ª<code>Pin&lt;P&gt;</code>å°±èƒ½æå®šã€‚è¿˜æœ‰æ›´æ—©çš„æ—¶å€™è¿˜è®¡åˆ’å¼•å…¥ä¸€ä¸ªå«<code>Move</code>çš„ trait æ¥æ ‡è®°è¯¥ç±»å‹æ˜¯å¦å¯ä»¥<code>move</code>ç­‰ç­‰ã€‚æˆ‘è¿™ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç åŸºäº 1.48 ç‰ˆï¼Œä¸ç¡®å®š<code>Pin</code>ä»¥åä¼šä¸ä¼šæœ‰æ›´æ–°ï¼Œè€Œä¸”<code>Pin</code>ç›®å‰è¿˜å­˜åœ¨ä¸€ä¸ª<code>unsoundness</code>çš„é—®é¢˜ã€‚ä¸ç®¡æ€æ ·ï¼Œä¸€åˆ‡ç®€å•ä¼˜é›…çš„è®¾è®¡èƒŒåä¸€å®šéšè—ç€å¤æ‚å’Œè‰°è¾›ï¼Œæ„Ÿè°¢ Rust å®˜æ–¹è¿‡å»çš„åŠªåŠ›ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿæœ‰å†…å­˜å®‰å…¨ã€æ— ç•å¹¶å‘å’Œç¬¦åˆäººä½“å·¥ç¨‹çš„ç¼–ç¨‹ä½“éªŒï¼</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../lang/rust/12-libp2pæ•™ç¨‹:ä½¿ç”¨Rustæ„å»ºp2påº”ç”¨.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../lang/rust/14-ä½¿ç”¨GDBè°ƒè¯•Ruståº”ç”¨.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../lang/rust/12-libp2pæ•™ç¨‹:ä½¿ç”¨Rustæ„å»ºp2påº”ç”¨.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../lang/rust/14-ä½¿ç”¨GDBè°ƒè¯•Ruståº”ç”¨.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../../theme/ferris.js"></script>
        

        

    </body>
</html>
